# The Agency

This is a meta-repo — it manages Claude Code configuration (agents, commands, workflows) distributed as the npm package `@apogeelabs/the-agency`. It is NOT an application — no server to start.

## What This Repo Contains

- **`src/templates/.claude/agents/`** — Subagent definitions (architect, dev, explorer, pm, reviewer, test-hardener)
- **`src/templates/.claude/commands/`** — Slash command definitions (architect, build, pm, review-pr)
- **`src/templates/.ai/`** — AI context files (unit test style guide, examples)
- **`src/`** — TypeScript source for the CLI sync tool
- **`dist/`** — Compiled JS output (gitignored, built via `pnpm build`)
- **`bin/`** — CLI entry point (thin shim into `dist/`)
- **`.claude/`** — Symlink to `src/templates/.claude/` (dogfooding)
- **`.ai/`** — Symlink to `src/templates/.ai/` (dogfooding)
- **`docs/briefs/`** — Product briefs for features (active)
- **`docs/build-plans/`** — Build plans for features (active)
- **`docs/archive/`** — Completed briefs and build plans
- **`docs/reports/`** — Generated build pipeline reports (gitignored)

## Directory Conventions

- Active briefs go in `docs/briefs/`, active build plans go in `docs/build-plans/`
- When a feature ships, move its brief and build plan to `docs/archive/briefs/` and `docs/archive/build-plans/`
- Reports generated by the build pipeline (`/build` command) land in `docs/reports/` and are gitignored

## Build & Test

- `pnpm build` — Compiles TypeScript source to `dist/` via tsup
- `pnpm test` — Runs Jest test suite
- `prepack` script automatically runs tsup before `pnpm pack`/`pnpm publish`
- Changesets manages versioning: `pnpm changeset` to create a changeset, `pnpm changeset version` to bump

## The Sync CLI

Consumers install this package and run `the-agency sync` to copy agents, commands, and `.ai/` files into their project. The file manifest lives in `src/manifest.ts` — when adding or removing distributable files, update the manifest.

## Working on Agents and Commands

Agent and command files are markdown with prompt engineering. When modifying them:

- Test against real scenarios, not in isolation
- Keep prompts self-contained — agents run in isolated context windows and don't share conversation history
- Agent files use YAML frontmatter (`name`, `description`, `tools`, `model`)
- Command files are pure markdown (no frontmatter)
- `settings.local.json` is project-specific and is NOT distributed to consumers

## Dogfooding

The root `.claude/` and `.ai/` directories are symlinks into `src/templates/`. This means editing files through either path updates the same file — the canonical copies in `src/templates/` ARE the ones Claude Code uses in this repo.

## Adding New Files

1. Create the file in the appropriate template directory (`src/templates/.claude/agents/`, `src/templates/.claude/commands/`, or `src/templates/.ai/`)
2. Add an entry to the manifest in `src/manifest.ts`
3. The symlinks ensure the file is immediately available to Claude Code in this repo
